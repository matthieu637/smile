#!/bin/bash

launch(){

torcs -r ~/.torcs/config/raceman/dtmrace.xml > /dev/null

nbCPU=$1
for i in {1..1000}
do 
  lsize=`cat /usr/local/share/games/torcs/matrix.txt | grep -v '0[.]0' | wc -l`
  episod=`expr $i \* 3 \* $nbCPU`
  echo "iter : $i | state learned : $lsize | simulated races :  $episod"
  pid=""
  for ((q=1; q <= $nbCPU ; q++))
  do
    torcs -r ~/.torcs/config/raceman/dtmrace.xml > /dev/null &
    pid="$pid $!"
  done
  for p in $pid
  do
	  wait $p
  done
done

}


if [ $# -eq 0 ] ; then
  nbCPU=`cat /proc/cpuinfo | grep processor | wc -l`
  launch $nbCPU
else
  launch $1
fi



